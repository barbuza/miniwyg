!function(){var a,b,c;b=function(a){return setTimeout(a,0)},a=function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this;if(!this.data("miniwyg")){for(document.execCommand("defaultParagraphSeparator",!1,"p"),i=jQuery('<div class="miniwyg">\n  <div class="panel"></div>\n  <div class="editor" contenteditable spellcheck="false"></div>\n</div>'),j=i.find(".panel:first"),f=i.find(".editor:first"),f.css("min-height",this.height()),f.html(this.text()),p=["bold","italic","underline"],m=function(a){var b,c;return c=a.charAt(0),j.append("<"+c+">"+c+"</"+c+">"),b=c.toUpperCase().charCodeAt(0),j.find(c).mousedown(function(){return document.execCommand(a,!1,null)}),f.keydown(function(c){return c.keyCode===b&&c.metaKey?document.execCommand(a,!1,null):void 0})},n=0,o=p.length;o>n;n++)e=p[n],m(e);return k=function(){return j.addClass("display"),b(function(){return j.addClass("show")})},h=function(){return j.removeClass("show")},jQuery(document.body).mousedown(h),f.mousedown(function(a){return a.stopPropagation()}),d=function(){return jQuery.trim(window.getSelection().toString()).length?k():h()},j.on("transitionend",function(){return j.hasClass("show")?void 0:j.removeClass("display")}),f.mouseup(function(){return b(d)}),f.keyup(d),f.keydown(d),i.css("max-width",this.outerWidth()),l=function(){return q.text(f.html())},g=this.parents("form:first"),g.submit(l),c=[],a=function(){},i.data("unbind",[{target:g,args:["submit",l]},{target:jQuery(document.body),args:["mousedown",h]}]),this.data("miniwyg",i),this.addClass("miniwyg_hidden_textarea"),this.after(i)}},c=function(){var a,b,c,d,e,f,g;if(b=this.data("miniwyg")){for(f=b.data("unbind"),d=0,e=f.length;e>d;d++)g=f[d],c=g.target,a=g.args,c.unbind.apply(c,a);return b.remove(),this.data("miniwyg",null),this.removeClass("miniwyg_hidden_textarea")}},jQuery.fn.miniwyg=function(b){var d,e,f,g;for(e=function(){switch(b){case"destroy":return c;default:return a}}(),f=0,g=this.length;g>f;f++)d=this[f],e.apply(jQuery(d));return this},jQuery(function(a){return a("textarea[role=miniwyg]").miniwyg()})}.call(this);